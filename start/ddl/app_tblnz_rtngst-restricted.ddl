CREATE VIEW ${var:view_db}.app_tblnz_rtngst AS
SELECT z.flngDockey, z.fstrRegistrationNo, z.fdtmFilingPeriod, z.fstrFilingFreq, z.fstrSourceType, z.fblnNil, z.fblnFinalReturn, z.fblnIncorrectForm, z.fstrFormTypeFiled, z.fstrFormTypeExpected, z.fblnHospice, z.fstrHospiceType, z.fblnProvisionalFiler, z.fstrProvisionalOption, z.fblnCompulsory, z.fblnMultibranchFiler, z.fblnTransitionalReturn, z.fblnCorrespondence, z.fstrVendorID, z.fstrSoftwareProvider, z.fstrWebLogonID, z.fblnQualifyRatio, z.fcurRatio, z.fcurGSTTotal, z.fcurTotalSales, z.fcurP1TotalSales, z.fcurP1ZeroSupplies, z.fcurP1IncomeCalculation, z.fcurP1GSTCollected, z.fcurP1LongTermSales, z.fcurP1LongTermGST, z.fcurP1HospitalSales, z.fcurP1HospitalGST, z.fcurP1SalesAdjustments, z.fcurP1NetSalesAndIncome, z.fcurP1TotalExpenses, z.fcurP1ExpensesCalculation, z.fcurP1CreditAdjustments, z.fcurP1GSTCredit, z.fcurP1TotalGST, z.fcurP2TotalSales, z.fcurP2ZeroSupplies, z.fcurP2LongTermSales, z.fcurP2LongTermGST, z.fcurP2HospitalSales, z.fcurP2HospitalGST, z.fcurP2SalesAdjustments, z.fcurP2TotalExpenses, z.fcurP2CreditAdjustments, z.fcurPTPreviousTotalSales, z.fcurPTTotalBranchSales, z.fcurPTIncludeBranchesTSI, z.fcurPTAssetAdjustment, z.fcurPTLessAssetsTSI, z.fcurPTInstalmentDue, z.fcurPTVoluntaryAmount, z.fcurPTRefundTransfer, z.fcurPTGSTToPay, z.fcurPTProvTaxDue, z.fcurPTPayment, z.fstrWho, z.fdtmWhen, z.record_effective_timestamp, z.record_expiry_timestamp, z.record_active_flag, z.record_deleted_flag, z.insert_object_run_key, z.update_object_run_key FROM ${var:source_db}.app_tblnz_rtngst z WHERE z.flngDockey IN (SELECT DISTINCT rtn.flngDockey FROM ${var:source_db}.app_tblreturn rtn INNER JOIN ${var:source_db}.app_tblaccount ac ON rtn.flngAccountKey = ac.flngAccountKey AND ac.record_deleted_flag = 'N' AND ac.record_active_flag = 'Y' INNER JOIN ${var:source_db}.app_tblcustomerlevel cl ON ac.flngcustomerkey = cl.flngcustomerkey WHERE nvl(cl.fstrCustomerLevel, 'STD') = 'STD' AND nvl(cl.record_active_flag, 'Y') = 'Y' AND nvl(cl.record_deleted_flag, 'N') = 'N');
