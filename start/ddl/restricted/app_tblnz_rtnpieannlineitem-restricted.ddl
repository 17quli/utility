CREATE VIEW ${var:view_db}.app_tblnz_rtnpieannlineitem AS
SELECT z.fi64LineItemKey, z.flngVer, z.flngVerLast, z.fstrPIEName, z.fstrPIEIRDNumber, z.fstrInvestorName, z.fstrInvestorIRDNumber, z.fstrRecipientStatus, z.fdtmInvestorDateOfBirth, z.fstrInvestorCertIdentifier, z.fcurRateYearEnd, z.fblnRateChanged, z.fcurUnitsHeldYearEnd, z.fdtmPeriod, z.fcurTotalIncomeLoss, z.fcurTotalTaxCredits, z.fcurNetTaxPaid, z.fcurTaxableIncomeLowMid, z.fcurTaxPaidLowMid, z.fcurTotalTaxCreditsLowMid, z.fcurZeroExitedTaxableIncome, z.fcurTotalForeignTaxCredits, z.fcurTotalOtherTaxCredits, z.fcurTotalICTaxCredits, z.fcurTotalRWTTaxCredits, z.fcurTaxPaymentExitedInvestors, z.fstrHomeAddressLine1, z.fstrHomeAddressLine2, z.fstrHomeAddressLine3, z.fstrHomeAddressLine4, z.fstrCountry, z.fstrCountryCode, z.fstrHomeTaxFileNumber, z.fstrNFIDTA, z.fblnHomeTaxFileDeclaration, z.fstrWho, z.fdtmWhen, z.record_effective_timestamp, z.record_expiry_timestamp, z.record_active_flag, z.record_deleted_flag, z.insert_object_run_key, z.update_object_run_key FROM ${var:source_db}.app_tblnz_rtnpieannlineitem z LEFT OUTER JOIN ${var:source_db}.app_tblcustomerinfo ci ON ci.fstrid = z.fstrPIEIRDNumber LEFT OUTER JOIN ${var:source_db}.app_tblcustomerinfo cii ON cii.fstrid = z.fstrInvestorIRDNumber WHERE nvl(ci.fstridtype, 'IRD') = 'IRD' AND nvl(ci.record_active_flag, 'Y') = 'Y' AND nvl(ci.record_deleted_flag, 'N') = 'N' AND nvl(ci.fstrCustomerLevel, 'STD') = 'STD' AND nvl(cii.fstridtype, 'IRD') = 'IRD' AND nvl(cii.record_active_flag, 'Y') = 'Y' AND nvl(cii.record_deleted_flag, 'N') = 'N' AND nvl(cii.fstrCustomerLevel, 'STD') = 'STD';
