CREATE VIEW ${var:view_db}.app_tblnz_ksb2bpaymentinbound AS
SELECT z.fi64KSB2BKey, z.fi64ContributionDetailKey, z.fstrPaymentID, z.fstrPaymentType, z.fcurPaymentAmount, z.fstrPaymentLineID, z.fstrPaymentDocumentNumber, z.fstrPaymentDocumentLineNumber, z.fstrEmployerIRDNumber, z.fstrEmployerName, z.fdtmPayDate, z.fdtmGVCPeriodEnd, z.fdtmVoluntaryPayment, z.fcurEmployerContributionAmount, z.fstrRefundReasonCode, z.fstrRefundLineID, z.fstrRefundLineNumberMember, z.fstrRefundLineNumberScheme, z.fstrRefundReferenceScheme, z.fstrRefundReferenceMember, z.fcurDirectMemberContributions, z.fcurTotalWithdrawalAmount, z.fcurTotalMortgageDiversion, z.fstrMemberTitle, z.fstrMemberFirstName, z.fstrMemberFamilyName, z.fstrMemberAddress1, z.fstrMemberStreet, z.fstrMemberStreet2, z.fstrMemberAddress2, z.fstrMemberUrbanization, z.fstrMemberCity, z.fstrMemberPostcode, z.fstrMemberCountry, z.fdtmAddressChange, z.fstrWho, z.fdtmWhen, z.record_effective_timestamp, z.record_expiry_timestamp, z.record_active_flag, z.record_deleted_flag, z.insert_object_run_key, z.update_object_run_key FROM ${var:source_db}.app_tblnz_ksb2bpaymentinbound z LEFT OUTER JOIN ${var:source_db}.app_tblnz_ksb2binbound inb ON z.fi64KSB2BKey = inb.fi64KSB2BKey LEFT OUTER JOIN ${var:source_db}.app_tblcustomerlevel cl ON inb.flngMemberCustomerKey = cl.flngCustomerKey WHERE (nvl(cl.fstrCustomerLevel, 'STD') != 'SPCAD2' AND nvl(cl.record_active_flag, 'Y') = 'Y' AND nvl(cl.record_deleted_flag, 'N') = 'N' AND nvl(inb.record_active_flag, 'Y') = 'Y' AND nvl(inb.record_deleted_flag, 'N') = 'N');
