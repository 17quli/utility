CREATE VIEW ${var:view_db}.app_tblnz_rtnipsslineitem AS
SELECT z.fi64LineItemKey, z.flngVer, z.flngVerLast, z.fdtmPeriod, z.fstrRecipientName, z.fstrRecipientIRD, z.fstrRecipientAddress1, z.fstrRecipientAddress2, z.fstrRecipientStatus, z.fcurInterestLiable1, z.fcurInterestLiable2, z.fcurInterestLiable3, z.fcurTotalInterestLiable, z.fcurRWTDeducted1, z.fcurRWTDeducted2, z.fcurRWTDeducted3, z.fcurTotalRWTDeducted, z.fcurRWTRate1, z.fcurRWTRate2, z.fcurRWTRate3, z.fcurRWTRateAverage, z.fstrBankAccountID, z.fstrBankAccountBranch, z.fstrBankAccountNumber, z.fstrBankAccountSuffix, z.fstrAccountNumber, z.fblnJointAccountIndicator, z.fstrPayerIRD, z.fstrPayerName, z.fstrPayerAddress1, z.fstrPayerAddress2, z.fstrWho, z.fdtmWhen, z.record_effective_timestamp, z.record_expiry_timestamp, z.record_active_flag, z.record_deleted_flag, z.insert_object_run_key, z.update_object_run_key FROM ${var:source_db}.app_tblnz_rtnipsslineitem z LEFT OUTER JOIN (SELECT fstrID, cl.fstrcustomerlevel FROM ${var:source_db}.app_tblid id INNER JOIN ${var:source_db}.app_tblcustomerlevel cl ON id.flngCustomerKey = cl.flngCustomerKey WHERE id.fstrIDtype = 'IRD' AND id.flngver = 0 AND id.fblnDefault = 1 AND nvl(id.record_active_flag, 'Y') = 'Y' AND nvl(id.record_deleted_flag, 'N') = 'N' AND nvl(cl.record_active_flag, 'Y') = 'Y' AND nvl(cl.record_deleted_flag, 'N') = 'N') idcl ON CAST(z.fstrRecipientIRD AS INT) = CAST(idcl.fstrID AS INT) LEFT OUTER JOIN (SELECT fstrID, cl.fstrcustomerlevel FROM ${var:source_db}.app_tblid id INNER JOIN ${var:source_db}.app_tblcustomerlevel cl ON id.flngCustomerKey = cl.flngCustomerKey WHERE id.fstrIDtype = 'IRD' AND id.flngver = 0 AND id.fblnDefault = 1 AND nvl(id.record_active_flag, 'Y') = 'Y' AND nvl(id.record_deleted_flag, 'N') = 'N' AND nvl(cl.record_active_flag, 'Y') = 'Y' AND nvl(cl.record_deleted_flag, 'N') = 'N') idcl_1 ON CAST(z.fstrPayerIRD AS INT) = CAST(idcl_1.fstrID AS INT) WHERE nvl(idcl.fstrcustomerlevel, 'STD') = 'STD' AND nvl(idcl_1.fstrcustomerlevel, 'STD') = 'STD';
