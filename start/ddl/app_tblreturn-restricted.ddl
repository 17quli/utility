CREATE VIEW ${var:view_db}.app_tblreturn AS
SELECT z.flngReturnKey, z.flngVer, z.flngVerLast, z.fi64DocSetKey, z.flngDockey, z.fintVerLastGood, z.flngJointReturnKey, z.flngAccountKey, z.flngSecondaryAccountKey, z.fdtmFilingPeriod, z.fstrDocType, z.fintDocVer, z.fdtmReturnGen, z.fdtmDataCapture, z.fdtmInAccount, z.fdtmReceived, z.fdtmDue, z.fblnInError, z.fstrFilingStatus, z.fstrId, z.fstrIdType, z.fstrNameControl, z.fstrSecondaryId, z.fstrSecondaryIdType, z.fstrSecondaryNameControl, z.fstrURI, z.fstrURIType, z.fstrAccountType, z.fstrMedia, z.fcurPayment, z.fstrStatus, z.flngBatchKey, z.fintSequence, z.fstrRtnBatchId, z.fstrReason, z.fblnEstimated, z.fblnPreliminary, z.fblnReceived, z.fblnRequired, z.flngCrmKey, z.flngFolderKey, z.fstrWho, z.fdtmWhen, z.record_effective_timestamp, z.record_expiry_timestamp, z.record_active_flag, z.record_deleted_flag, z.insert_object_run_key, z.update_object_run_key FROM ${var:source_db}.app_tblreturn z LEFT OUTER JOIN ${var:source_db}.app_tblaccount ac ON z.flngaccountkey = ac.flngaccountkey AND ac.record_active_flag = 'Y' LEFT OUTER JOIN ${var:source_db}.app_tblcustomerlevel cl ON ac.flngcustomerkey = cl.flngcustomerkey WHERE nvl(cl.fstrCustomerLevel, 'STD') = 'STD' AND nvl(cl.record_active_flag, 'Y') = 'Y' AND nvl(cl.record_deleted_flag, 'N') = 'N';
