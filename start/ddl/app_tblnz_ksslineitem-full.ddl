CREATE VIEW ${var:view_db}.app_tblnz_ksslineitem AS
SELECT z.flngReturnKey, z.flngItemNumber, z.flngAccountKey, z.fdtmFilingPeriod, z.fdtmPayDayPeriod, z.fi64KSEContributionKey, z.fi64KSRContributionKey, z.fblnReversed, z.fblnKSEConverted, z.fblnKSRConverted, z.fstrCnvIRDNumber, z.fstrCnvEmployeeName, z.fstrCnvTaxCode, z.fcurCnvKiwiSaverDeductions, z.fcurCnvKiwiSaverContributions, z.fstrWho, z.fdtmWhen, z.record_effective_timestamp, z.record_expiry_timestamp, z.record_active_flag, z.record_deleted_flag, z.insert_object_run_key, z.update_object_run_key FROM ${var:source_db}.app_tblnz_ksslineitem z LEFT OUTER JOIN ${var:source_db}.app_tblaccount a ON CAST(z.flngAccountKey AS INT) = CAST(a.flngAccountKey AS INT) LEFT OUTER JOIN ${var:source_db}.app_tblcustomerlevel c ON a.flngcustomerkey = c.flngcustomerkey WHERE nvl(a.record_active_flag, 'Y') = 'Y' AND nvl(a.record_deleted_flag, 'N') = 'N' AND nvl(c.fstrCustomerLevel, 'STD') != 'SPCAD2' AND nvl(c.record_active_flag, 'Y') = 'Y' AND nvl(c.record_deleted_flag, 'N') = 'N';
