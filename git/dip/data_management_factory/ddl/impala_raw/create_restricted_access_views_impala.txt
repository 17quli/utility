  /**************************************************************************************************
17/10/19  Initial script
06/11/19  Added 3 new views app_tblcustomerhistory, app_tblnz_customerstd, ref_lanIndicator 
06/11/19  Parameterised the view creation
06/11/19  Removed tblcustomerlevel from the join condition in tbldocposttransaction and tblwebrequest

**************************************************************************************************/
CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblaccount 
AS SELECT z.flngAccountKey, 
       z.flngVer, 
       z.flngVerLast, 
       z.flngCustomerKey, 
       z.fintParentProfileNumber, 
       z.fintProfileNumber, 
       z.fstrAccountType, 
       z.fstrFiling, 
       z.fdtmCommence, 
       z.fdtmCease, 
       z.fstrStatus, 
       z.fstrClosureReason, 
       z.fblnMailForm, 
       z.flngDocKey, 
       z.flngFolderKey, 
       z.fdtmCreated, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblaccount z ;
 
CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblaccountinfo 
AS SELECT z.flngAccountKey, 
       z.fintParentProfileNumber, 
       z.fintProfileNumber, 
       z.flngCustomerKey, 
       z.flngJointCustomerKey, 
       z.flngJointAccountKey, 
       z.fblnPrime, 
       z.fstrAccountType, 
       z.flngDocKey, 
       z.flngFolderKey, 
       z.fstrFilingFrq, 
       z.fdtmCommence, 
       z.fdtmCease, 
       z.fdtmCreated, 
       z.fi64NameKey, 
       z.fintNameKey, 
       z.fstrDisplay, 
       z.fblnFormatted, 
       z.fstrNameType, 
       z.fstrFamilyName, 
       z.fstrMiddleName, 
       z.fstrFirstName, 
       z.fstrNameControl, 
       z.fstrTitle, 
       z.fstrSuffix, 
       z.fstrFreeFormatName, 
       z.fstrListFormatName, 
       z.fstrAdditionalName, 
       z.fstrAdditionalName2, 
       z.fi64AddressKey, 
       z.fintAddressKey, 
       z.fstrAddressType, 
       z.fstrStreet, 
       z.fstrStreet2, 
       z.fstrUnitType, 
       z.fstrUnit, 
       z.fstrCity, 
       z.fstrCounty, 
       z.fstrState, 
       z.fstrZip, 
       z.fstrDistrictOffice, 
       z.fstrCountry, 
       z.fstrAttention, 
       z.fstrLocationCode, 
       z.fstrUrbanization, 
       z.fstrMunicipality, 
       z.fstrDistrict, 
       z.fstrSubDistrict, 
       z.fstrSubProvince, 
       z.fstrAddressDescription, 
       z.fstrListFormatAddress, 
       z.flngIDKey, 
       z.fstrIDType, 
       z.fstrID, 
       z.fstrFormattedID, 
       z.fstrCollectDistrictOffice, 
       z.fstrCollectCity, 
       z.fstrCustomerType, 
       z.fstrReviewType, 
       z.fstrCustomerLevel, 
       z.fi64ProtectedDataSource, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblaccountinfo z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngCustomerkey = cl.flngCustomerkey 
AND cl.record_active_flag = 'Y' 
AND cl.record_deleted_flag = 'N' 
WHERE cl.fstrCustomerLevel = 'STD' ;

CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblcrmextendedlog 
AS SELECT z.FLNGCRMKEY,
       z.FLNGVER,
       z.FLNGVERLAST,
       z.FSTRCRMSOURCE,
       z.FSTRCRMTYPE,
       z.FLNGPARENTCRMKEY,
       z.FLNGCUSTOMERKEY,
       z.FINTPROFILENUMBER,
       z.FLNGACCOUNTKEY,
       z.FSTRACCOUNTTYPE,
       z.FDTMFILINGPERIOD,
       z.FLNGBILLITEMKEY,
       z.FINTBILLITEM,
       z.FLNGFOLDERKEY,
       z.FI64SOURCEKEY,
       z.FSTRSOURCEID,
       z.FSTRSOURCETYPE,
       z.FSTRSOURCEDATA,
       z.FSTRDATA,
       z.FBLNEXTENDED,
       z.FBLNPRIVATE,
       z.FBLNHASCHILDREN,
       z.FBLNHIGHIMPORTANCE,
       z.FBLNSYSTEM,
       z.FSTREDITEDBY,
       z.FDTMEDITED,
       z.FSTRCOMMENT,
       z.FBLNCOMMENTEXISTS,
       z.FSTRWHO,
       z.FDTMWHEN,
       z.record_effective_timestamp,
       z.record_expiry_timestamp,
       z.record_active_flag,
       z.record_deleted_flag,
       z.insert_object_run_key,
       z.update_object_run_key
FROM ${target_db=Enter the target database name here}_raw.app_tblcrmextendedlog z
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngCustomerKey = cl.flngCustomerKey
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD'
  AND nvl(cl.record_active_flag, 'Y') = 'Y'
  AND nvl(cl.record_deleted_flag, 'N') = 'N';



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblcustomer
AS SELECT z.flngCustomerKey, 
       z.flngVer, 
       z.flngVerLast, 
       z.fstrCustomerType, 
       z.fdtmCommence, 
       z.fdtmCease, 
       z.flngCustomerLevel, 
       z.flngDocKey, 
       z.flngFolderKey, 
       z.flngRefreshVer, 
       z.flngCustomerVersion, 
       z.flngWebVersion, 
       z.fdtmWebPublished, 
       z.fdtmCreated, 
       z.fstrWho, 
       z.fdtmWhen,
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblcustomer z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngCustomerKey = z.flngCustomerKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;

CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblcustomerinfo
AS SELECT z.flngCustomerKey, 
       z.flngJointCustomerKey, 
       z.fblnPrime, 
       z.fstrCustomerType, 
       z.flngDocKey, 
       z.flngFolderKey, 
       z.fblnDefault, 
       z.fintProfileNumber, 
       z.fdtmCommence, 
       z.fdtmCease, 
       z.fdtmCreated, 
       z.fi64NameKey, 
       z.fintNameKey, 
       z.fstrDisplay, 
       z.fblnFormatted, 
       z.fstrNameType, 
       z.fstrFamilyName, 
       z.fstrMiddleName, 
       z.fstrFirstName, 
       z.fstrNameControl, 
       z.fstrTitle, 
       z.fstrSuffix, 
       z.fstrFreeFormatName, 
       z.fstrListFormatName, 
       z.fstrAdditionalName, 
       z.fstrAdditionalName2, 
       z.fi64AddressKey, 
       z.fintAddressKey, 
       z.fstrAddressType, 
       z.fstrStreet, 
       z.fstrStreet2, 
       z.fstrUnitType, 
       z.fstrUnit, 
       z.fstrCity, 
       z.fstrCounty, 
       z.fstrState, 
       z.fstrZip, 
       z.fstrCountry, 
       z.fstrAttention, 
       z.fstrLocationCode, 
       z.fstrUrbanization, 
       z.fstrMunicipality, 
       z.fstrDistrict, 
       z.fstrSubDistrict, 
       z.fstrSubProvince, 
       z.fstrAddressDescription, 
       z.fstrListFormatAddress, 
       z.flngIDKey, 
       z.fstrIDType, 
       z.fstrID, 
       z.fstrFormattedID, 
       z.fstrDistrictOffice, 
       z.fstrCollectDistrictOffice, 
       z.fstrReviewType, 
       z.fstrCustomerLevel, 
       z.fi64ProtectedDataSource, 
       z.fdtmWhen, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblcustomerinfo z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngCustomerkey = cl.flngCustomerkey 
AND cl.record_active_flag = 'Y' 
AND cl.record_deleted_flag = 'N' 
WHERE cl.fstrCustomerLevel = 'STD';


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblcustomermail
AS 
SELECT z.flngMailItemKey, 
       z.fstrFormat, 
       z.flngMailCategoryKey, 
       z.flngCustomerKey, 
       z.flngAccountKey, 
       z.fintAddressKey, 
       z.fintAddressProfile, 
       z.fintNameKey, 
       z.fintNameProfile, 
       z.flngBillItemKey, 
       z.fdtmFilingPeriod, 
       z.flngMailItemTypeKey, 
       z.flngTemplateKey, 
       z.fstrLetterId, 
       z.fstrMailType, 
       z.fdtmRequest, 
       z.fdtmReady, 
       z.fdtmPrinted, 
       z.fdtmRePrinted, 
       z.fdtmResend, 
       z.fdtmEmailed, 
       z.fblnValid, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblcustomermail z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngCustomerKey = z.flngCustomerKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblcustomerstd
AS 
SELECT z.FLNGDOCKEY, 
       z.FDTMDOB, 
       z.FDTMDOD, 
       z.FSTRWHO, 
       z.FDTMWHEN, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblcustomerstd z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngDocKey = cl.flngDocKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tbldocposttransaction
AS
SELECT z.flngDocKey, 
       z.fstrField, 
       z.flngTableRow, 
       z.flngDocVerLast, 
       z.flngVer, 
       z.flngVerLast, 
       z.fintPosting, 
       z.fi64SourceKey, 
       z.fstrSource, 
       z.fstrIdType, 
       z.fstrId, 
       z.fstrNameControl, 
       z.flngCustomerKey, 
       z.flngAccountKey, 
       z.fstrAccountType, 
       z.fdtmFilingPeriod, 
       z.flngBillItemKey, 
       z.fstrBillType, 
       z.fdtmBillDue, 
       z.fstrGroup, 
       z.flngTransKey, 
       z.fstrTransType, 
       z.fdtmEffect, 
       z.fdtmReport, 
       z.fcurAmount, 
       z.fintWorkStatus, 
       z.fblnProcessed, 
       z.fdtmReviewed, 
       z.fdtmPosted, 
       z.fdtmReversed, 
       z.fblnUpdatePeriod, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tbldocposttransaction z 
LEFT JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngDocKey = z.flngcustomerkey
WHERE cl.fstrCustomerLevel = 'STD' 
  AND cl.record_active_flag = 'Y' 
  AND cl.record_deleted_flag = 'N' ;




CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblid
AS 
SELECT z.FLNGIDKEY, 
       z.FLNGVER, 
       z.FLNGCUSTOMERKEY, 
       z.FSTRIDTYPE, 
       z.FSTRID, 
       z.FLNGACCOUNTKEY, 
       z.FLNGVERLAST, 
       z.FBLNVALIDATED, 
       z.FBLNACTIVE, 
       z.FINTPROFILENUMBER, 
       z.FBLNDEFAULT, 
       z.fdtmCommence, 
       z.fdtmCease, 
       z.flngImageKey, 
       z.flngDocKey, 
       z.flngCrmKey, 
       z.fi64ProtectedDataSource, 
       z.fintProtectLevel, 
       z.FSTRWHO, 
       z.FDTMWHEN, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblid z 
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngCustomerKey = cl.flngCustomerKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblindicator
AS
SELECT z.FLNGINDICATORKEY, 
       z.FLNGVER, 
       z.FLNGVERLAST, 
       z.FINTLEVEL, 
       z.FLNGCUSTOMERKEY, 
       z.FINTPROFILENUMBER, 
       z.FLNGACCOUNTKEY, 
       z.FSTRINDICATOR, 
       z.FDTMCOMMENCE, 
       z.FDTMFILINGPERIOD, 
       z.FDTMFILINGPERIODTO, 
       z.FCURAMOUNT, 
       z.FDTMCEASE, 
       z.FSTRREASON, 
       z.FDTMCOMMENCE1, 
       z.FDTMCEASE1, 
       z.flngCrmKey, 
       z.FSTRCOMMENT, 
       z.FSTRUSER, 
       z.flngDocKey, 
       z.fblnActive, 
       z.FSTRWHO, 
       z.FDTMWHEN, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblindicator z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngCustomerKey = z.flngCustomerKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblmailitem
AS 
SELECT z.flngMailItemKey, 
       z.flngVerLast, 
       z.flngMailTypeKey, 
       z.flngTemplateKey, 
       z.flngCRMKey, 
       z.fstrRecipientKey, 
       z.flngNameAddressHash, 
       z.fstrSortKey, 
       z.fdtmSortDate, 
       z.fintMailTypeSort, 
       z.fstrLanguage, 
       z.fstrAddressBlock, 
       z.fstrEmailTo, 
       z.fstrName, 
       z.fstrDLN, 
       z.fstrCity, 
       z.fstrCountry, 
       z.fstrZip, 
       z.fblnValidAddress, 
       z.fdtmCreated, 
       z.fstrCreatedwho, 
       z.fdtmBatched, 
       z.fdtmPrinted, 
       z.fstrPrintedwho, 
       z.fstrPrinter, 
       z.fdtmRePrinted, 
       z.fstrReprintedwho, 
       z.fstrRePrintPrinter, 
       z.fdtmReady, 
       z.fstrReadyWho, 
       z.fdtmEmailedOn, 
       z.flngPrintGroupKey, 
       z.fblnValid, 
       z.fstrValidatedwho, 
       z.fdtmValidatedwhen, 
       z.fblnElectronicOnly, 
       z.fstrRenderType, 
       z.fstrDatabase, 
       z.flngImageKey, 
       z.fblnLock, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblmailitem z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomermail w ON z.flngMailItemKey = w.flngMailItemKey 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngCustomerKey = w.flngCustomerKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnaics
AS 
SELECT z.flngNAICSKey, 
       z.flngVer, 
       z.flngVerLast, 
       z.fstrNAICSVersion, 
       z.fstrNAICS, 
       z.fstrLevel1, 
       z.fstrLevel2, 
       z.fstrLevel3, 
       z.fstrLevel4, 
       z.fstrLevel5, 
       z.fstrLevel6, 
       z.flngCustomerKey, 
       z.fintProfileNumber, 
       z.flngAccountKey, 
       z.fdtmCommence, 
       z.fdtmCease, 
       z.fcurBusinessMakeup, 
       z.fblnDefault, 
       z.fblnActive, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnaics z 
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngCustomerKey = cl.flngCustomerKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnamerecord
AS
SELECT z.fi64NameKey,
       z.flngVer,
       z.flngVerLast,
       z.fdtmEffectiveFrom,
       z.fdtmEffectiveTo,
       z.fdtmSystemFrom,
       z.fdtmSystemTo,
       z.fstrSource,
       z.flngCustomerKey,
       z.fintProfileNumber,
       z.fi64SourceKey,
       z.fstrNameType,
       z.fstrDisplay,
       z.fblnFormatted,
       z.fstrLastName,
       z.fintLastModifier,
       z.fstrFirstName,
       z.fintFirstModifier,
       z.fstrMiddleName,
       z.fintMiddleModifier,
       z.fstrTitle,
       z.fintTitleModifier,
       z.fstrSuffix,
       z.fintSuffixModifier,
       z.fstrFreeFormatName,
       z.fintFreeFormatModifier,
       z.fstrAdditionalName,
       z.fintAdditionalModifier,
       z.fstrAdditionalName2,
       z.fintAdditionalModifier2,
       z.fstrListFormatName,
       z.fi64ProtectedDataSource,
       z.flngCrmKey,
       z.fblnBlank,
       z.fblnCurrent,
       z.fblnActive,
       z.fintProtectLevel,
       z.fstrWho,
       z.fdtmWhen,
       z.record_expiry_timestamp,
       z.record_active_flag,
       z.record_deleted_flag,
       z.insert_object_run_key,
       z.update_object_run_key
FROM ${target_db=Enter the target database name here}_raw.app_tblnamerecord z
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngCustomerKey = cl.flngCustomerKey
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD'
  AND nvl(cl.record_active_flag, 'Y') = 'Y'
  AND nvl(cl.record_deleted_flag, 'N') = 'N';


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_accidgedu
AS 
SELECT z.flngDocKey, 
       z.fstrEducationProvider, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_accidgedu z ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_accidgovr
AS 
SELECT z.flngDocKey, 
       z.fstrIssuingCountry, 
       z.fblnTranslationReceived, 
       z.flngEntryNumber, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_accidgovr z ;

CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_calllog 
AS 
SELECT z.flngVisitKey, 
       z.flngVer, 
       z.flngVerLast, 
       z.fstrIrdNumber, 
       z.fstrAuthIRDNumber, 
       z.flngChildVisitKey, 
       z.fstrUpdateReason, 
       z.fstrIvrPath, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_calllog z 
WHERE z.flngVisitKey IN 
    (SELECT DISTINCT tv.flngVisitKey 
     FROM ${target_db=Enter the target database name here}_raw.app_tblvisit tv 
     INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON tv.flngcustomerkey = cl.flngcustomerkey 
     WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
       AND nvl(cl.record_active_flag, 'Y') = 'Y' 
       AND nvl(cl.record_deleted_flag, 'N') = 'N') ;




CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_cstcominfo
AS
SELECT z.flngDocKey, 
       z.fstrURL, 
       z.fblnNilCompany, 
       z.fblnDonee, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_cstcominfo z 
INNER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngDocKey = z.flngDocKey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;

CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_custsegmenthist
AS 
SELECT z.flngDocKey, 
       z.flngVerLast, 
       z.fstrCustomerSegment, 
       z.fstrWho, 
       Z.fdtmwhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_custsegmenthist z ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_custtaxresidency
AS 
SELECT z.FLNGDOCKEY, 
       z.FINTSEQ, 
       z.FSTRTAXRESIDENCY, 
       z.FDTMRESSTART, 
       z.FDTMRESEND, 
       z.FBLNISFINANCIAL, 
       z.FSTRWHO, 
       z.FDTMWHEN, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_custtaxresidency z 
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel i ON z.FLNGDOCKEY = i.FLNGDOCKEY 
AND nvl(i.fstrcustomerlevel, 'STD') = 'STD' 
AND nvl(i.record_active_flag, 'Y') = 'Y' 
AND nvl(i.record_deleted_flag, 'N') = 'N' ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblnz_visitmanagedcall
AS 
SELECT z.flngDocKey, 
       z.fstrCallerIrdNumber, 
       z.fstrAuthorisedIrdNumber, 
       z.fstrTaxAgentName, 
       z.fstrVoiceEnrolStatus, 
       z.fstrVoiceOptOutStatus, 
       z.fstrTransferReason, 
       z.fstrCallerIntentCorrect, 
       z.fstrCallerIntent, 
       z.fstrCorrectedIntent, 
       z.fstrCallQueue, 
       z.fstrStageOneFeedback, 
       z.fblnVirtualHold, 
       z.fblnContactDetailsChecked, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_visitmanagedcall z 
LEFT OUTER JOIN 
  (SELECT DISTINCT fstrid 
   FROM ${target_db=Enter the target database name here}_raw.app_tblcustomerinfo 
   WHERE fstridtype = 'IRD' 
     AND record_active_flag = 'Y' 
     AND record_deleted_flag = 'N' 
     AND (fstrcustomerlevel IS NULL 
          OR fstrcustomerlevel = 'STD')) i1 ON i1.fstrid = z.fstrcallerirdnumber 
LEFT OUTER JOIN 
  (SELECT DISTINCT fstrid 
   FROM ${target_db=Enter the target database name here}_raw.app_tblcustomerinfo 
   WHERE fstridtype = 'IRD' 
     AND record_active_flag = 'Y' 
     AND record_deleted_flag = 'N' 
     AND (fstrcustomerlevel IS NULL 
          OR fstrcustomerlevel = 'STD')) i2 ON i2.fstrid = z.fstrAuthorisedIrdNumber 
WHERE (z.fstrcallerirdnumber IS NULL 
       AND i1.fstrid IS NOT NULL) 
  OR (z.fstrauthorisedirdnumber IS NULL 
      AND i1.fstrid IS NOT NULL) 
  OR (i1.fstrid IS NOT NULL 
      AND i2.fstrid IS NOT NULL) 
  OR (z.fstrcallerirdnumber IS NULL 
      AND z.fstrAuthorisedIrdNumber IS NULL) ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblvisit
AS 
SELECT z.flngVisitKey, 
       z.flngVer, 
       z.flngVerLast, 
       z.fstrVisitSource, 
       z.fstrVisitCategory, 
       z.fstrVisitSubCategory, 
       z.flngFolderKey, 
       z.flngCustomerKey, 
       z.fblnUnregisteredVisitor, 
       z.fi64NameKey, 
       z.fi64AddressKey, 
       z.fstrVisitId, 
       z.fstrTicketId, 
       z.fstrExternalId, 
       z.fstrIdType, 
       z.fstrId, 
       z.fstrCountry, 
       z.fintCountryCode, 
       z.fstrAreaCode, 
       z.fstrPhoneNumber, 
       z.fblnVisitorVerified, 
       z.fstrVerifyDocType, 
       z.fintVerifyDocVer, 
       z.fi64VerifyDocEditInProgressKey, 
       z.flngVerifyDocKey, 
       z.fstrDocType, 
       z.fintDocVer, 
       z.fi64DocEditInProgressKey, 
       z.flngDocKey, 
       z.flngXmlKey, 
       z.fstrOwner, 
       z.fstrDistrictOffice, 
       z.fblnHold, 
       z.fdtmVisitStart, 
       z.fdtmVisitEnd, 
       z.flngDuration, 
       z.flngWaitTime, 
       z.fblnActive, 
       z.fdtmReversed, 
       z.fstrWho, 
       z.fdtmWhen, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblvisit z 
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON z.flngcustomerkey = cl.flngcustomerkey 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
  AND nvl(cl.record_active_flag, 'Y') = 'Y' 
  AND nvl(cl.record_deleted_flag, 'N') = 'N' ;




CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_agents
AS
SELECT z.IRD_NUMBER, 
       z.LOCATION_NUMBER, 
       z.DATE_APPLIED, 
       z.AGT_DATE_START, 
       z.AGT_DATE_END, 
       z.AGENT_TYPE, 
       z.OLD_SYSTEM_NUMBER, 
       z.AGENCY_IRD_NUMBER, 
       z.AGENCY_LOCATION_NUMBER, 
       z.AGENT_TIME_EXTENSION, 
       z.WITHDRAW_DATE, 
       z.OFFICE_NUMBER, 
       z.SEGMNT, 
       z.MICRO_SEGMNT, 
       z.ACCOUNT_MANAGER_ID, 
       z.EFILE_ACCESS, 
       z.EFILE_TARGET, 
       z.`TIMESTAMP`, 
       z.DATE_CEASED, 
       z.PROFESSIONAL_ORG_CODE, 
       z.PUBLIC_PRACTICE_CERT_IND, 
       z.EMPLOYER_RETURNS_IND, 
       z.OTHER_RETURN_IND, 
       z.EMAIL_ADDRESS, 
       z.EFILE_IRD_NUMBER, 
       z.EFILE_LOCATION_NUMBER, 
       z.EFILE_REPORT_OPTION, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_agents z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' ;





CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_client_codes
AS 
SELECT z.IRD_NUMBER, 
       z.LOCATION_NUMBER, 
       z.TAX_TYPE, 
       z.CLIENT_CODE_TYPE, 
       z.CLIENT_CODE_VALUE, 
       z.DATE_START, 
       z.DATE_APPLIED, 
       z.DATE_END, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.USER_ID, 
       z.DATE_PROCESSED, 
       z.CLIENT_CODE_KEY, 
       z.BEGIN_CHANGE_REASON_CODE, 
       z.END_CHANGE_REASON_CODE, 
       z.INBOUND_DOC_LODGE_NBR_PREFIX, 
       z.INBOUND_DOC_LODGE_NBR, 
       z.OUTBOUND_DOC_LODGE_NBR_PREFIX, 
       z.OUTBOUND_DOC_LODGE_NBR, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_client_codes z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' ;





CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_client_names 
AS 
SELECT z.IRD_NUMBER, 
       z.LOCATION_NUMBER, 
       z.CLIENT_NAME_TYPE, 
       z.SEQUENCE_NUMBER, 
       z.DATE_APPLIED, 
       z.FIRST_NAMES, 
       z.SURNAME, 
       z.TITLE, 
       z.ORGANISATION_NAME, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_client_names z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_clients
AS 
SELECT z.IRD_NUMBER, 
       z.ENTITY_TYPE, 
       z.DATE_APPLIED, 
       z.ENTITY_CLASS, 
       z.CUST_TYPE, 
       z.MASTER_LOCATION, 
       z.DATE_CREATED, 
       z.DATE_OF_BIRTH, 
       z.ORG_COMMENCEMENT_DATE, 
       z.CLIENT_STATUS, 
       z.RESIDENT_IND, 
       z.SIC_SOURCE, 
       z.LOAN_IND, 
       z.SECURE_IND, 
       z.CLIENT_PASSWORD, 
       z.RWT_RATE, 
       z.IDENTIFICATION_TYPE_CODE, 
       z.ID_SERIAL_NUMBER, 
       z.PHONE_NUMBER, 
       z.WORK_PHONE_NUMBER, 
       z.CELL_PHONE_NUMBER, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.GENDER, 
       z.NOMINATED_GST_IRD_NUMBER, 
       z.NOMINATED_GST_LOCATION_NUMBER, 
       z.LATEST_INC_PERIOD_ASSESSED, 
       z.BALANCE_DATE, 
       z.PROVISIONAL_IND_CODE, 
       z.RATIO_PERCENTAGE, 
       z.RATIO_STATUS_CODE, 
       z.RATIO_BASE_PERIOD_DATE, 
       z.CURRENT_CAL_RATIO_START_DATE, 
       z.RATIO_PENDING_INDICATOR, 
       z.INTERVIEW_REQUIRED_IND, 
       z.NZ_CITIZEN_IND, 
       z.VERIFIER_ORGANISATION_ID, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_clients z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' ;





CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_customers
AS 
SELECT z.IRD_NUMBER, 
       z.LOCATION_NUMBER, 
       z.ENTITY_TYPE, 
       z.ENTITY_CLASS, 
       z.CLIENT_STATUS, 
       z.SEGMENT_ID, 
       z.MICRO_SEGMENT, 
       z.DISTRICT_OFFICE, 
       z.SERVICE_CENTRE, 
       z.DATE_APPLIED, 
       z.DATE_CEASED, 
       z.DATE_OF_BIRTH, 
       z.ORG_COMMENCEMENT_DATE, 
       z.LOAN_INDICATOR, 
       z.RESIDENT_INDICATOR, 
       z.SIC_CODE, 
       z.DATE_ADVISORY_VISIT, 
       z.ADDRESS_STATUS, 
       z.CUST_TYPE, 
       z.DATE_CREATED, 
       z.SIC_SOURCE, 
       z.IDENTIFICATION_TYPE_CODE, 
       z.ID_SERIAL_NUMBER, 
       z.PHONE_NUMBER, 
       z.WORK_PHONE_NUMBER, 
       z.CELL_PHONE_NUMBER, 
       z.NATURE_OF_BUSINESS, 
       z.MESH_BLOCK, 
       z.GENDER, 
       z.INTERVIEW_REQUIRED_IND, 
       z.NZ_CITIZEN_IND, 
       z.VERIFIER_ORGANISATION_ID, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_customers z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' ;





CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_entity_classes
AS
SELECT z.ENTITY_CLASS_CODE, 
       z.DATE_APPLIED, 
       z.DESCRIPTION, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.VALIDATED, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_entity_classes z ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_entity_types
AS 
SELECT z.ENTITY_TYPE_CODE, 
       z.DATE_APPLIED, 
       z.DESCRIPTION, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.VALIDATED, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_entity_types z ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_external_references
AS
SELECT z.IRD_NUMBER, 
       z.LOCATION_NUMBER, 
       z.EXTERNAL_ORG_CODE, 
       z.EXTERNAL_ID, 
       z.DATE_START, 
       z.DATE_APPLIED, 
       z.DATE_END, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.COUNTRY_CODE, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_external_references z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_offices
AS 
SELECT z.OFFICE_CODE, 
       z.DESCRIPTION, 
       z.SERVICE_CENTRE_CODE, 
       z.DATE_APPLIED, 
       z.DATE_CEASED, 
       z.VALIDATED, 
       z.`TIMESTAMP`, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_offices z ;

CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.dss_old_system_numbers
AS 
SELECT z.OLD_SYSTEM_NUMBER, 
       z.IRD_NUMBER, 
       z.LOCATION_NUMBER, 
       z.DATE_APPLIED, 
       z.DATE_CEASED, 
       z.`TIMESTAMP`, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.dss_old_system_numbers z 
INNER JOIN ${target_db=Enter the target database name here}_raw.dss_special_clients_all s ON CAST(s.IRD_NUMBER AS INT) = CAST(z.IRD_NUMBER AS INT) 
WHERE s.special_classification = 'STD' 
  AND s.record_active_flag = 'Y' 
  AND s.record_deleted_flag = 'N' ;







CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lancountry
AS 
SELECT z.fstrLanguage, 
       z.fstrCountry, 
       z.fstrDecode1, 
       z.fstrDecode2, 
       z.fstrDecode3, 
       z.fstrDescription, 
       z.fstrStateDecode, 
       z.fstrPhoneError, 
       z.fstrNationality, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lancountry z ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lancustomerlevel
AS
SELECT z.FSTRLANGUAGE,
       z.FSTRCUSTOMERLEVEL,
       z.FSTRDECODE1,
       z.FSTRDECODE2,
       z.fstrDescription,
       z.record_effective_timestamp,
       z.record_expiry_timestamp,
       z.record_active_flag,
       z.record_deleted_flag,
       z.insert_object_run_key,
       z.update_object_run_key
FROM ${target_db=Enter the target database name here}_raw.ref_lancustomerlevel z;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lancustomersubtype
AS 
SELECT z.fstrLanguage, 
       z.fstrCustomerSubType, 
       z.fstrDecode1, 
       z.fstrDecode2, 
       z.fstrDescription, 
       z.fstrDecodeWeb, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lancustomersubtype z ;




CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lancustomertype
AS 
SELECT z.fstrLanguage, 
       z.fstrCustomerType, 
       z.fstrDecode1, 
       z.fstrDecode2, 
       z.fstrDecodeWeb, 
       z.FSTRDESCRIPTION, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lancustomertype z ;




CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lannz_customerclass
AS 
SELECT z.fstrLanguage, 
       z.fstrCustomerClass, 
       z.fstrDecode1, 
       z.fstrDecode2, 
       z.fstrDescription, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lannz_customerclass z ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lannz_customersegments
AS 
SELECT z.fstrSegment, 
       z.fstrLanguage, 
       z.fstrDecode1, 
       z.fstrDecode2, 
       z.fstrDescription, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lannz_customersegments z ;



CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lanofficelocation
AS 
SELECT z.FSTRLANGUAGE, 
       z.FSTRDISTRICTOFFICE, 
       z.FSTRDECODE1, 
       z.FSTRDECODE2, 
       z.fstrDescription, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lanofficelocation z ;





CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.wrq_tblwebnotice
AS 
SELECT z.FLNGWEBNOTICEKEY, 
       z.FLNGVER, 
       z.FLNGVERLAST, 
       z.FSTRWEBNOTICEAREA, 
       z.FSTRWEBNOTICECATEGORY, 
       z.FSTRWEBNOTICETYPE, 
       z.FSTRWEBNOTICESUBTYPE, 
       z.FSTRWEBNOTICEREASON, 
       z.FSTRAPPLICATION, 
       z.FLNGCUSTOMERKEY, 
       z.FLNGACCOUNTKEY, 
       z.FDTMFILINGPERIOD, 
       z.FLNGWEBLOGONKEY, 
       z.FLNGPARENTNOTICEKEY, 
       z.FLNGWEBREQKEY, 
       z.FSTRSUBJECT, 
       z.FSTRMESSAGE, 
       z.FSTRADDITIONALINFO, 
       z.FBLNURGENT, 
       z.FBLNUSER, 
       z.FBLNPRIVATE, 
       z.FSTRLANGUAGE, 
       z.FSTRWHO, 
       z.FDTMWHEN, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.wrq_tblwebnotice z 
LEFT OUTER JOIN ${target_db=Enter the target database name here}_raw.app_tblcustomerlevel cl ON cl.flngDocKey = z.flngcustomerkey
AND cl.record_active_flag = 'Y' 
AND cl.record_deleted_flag = 'N' 
WHERE (cl.fstrCustomerLevel = 'STD' 
       OR z.flngCustomerKey = 0) ;


CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.APP_TBLNZ_CUSTOMERSTD
AS
SELECT z.FLNGDOCKEY, 
       z.FSTRCUSTOMERSUBTYPECLASS, 
       z.FSTRCUSTOMERSUBTYPE, 
       z.FSTRCUSTOMERSEGMENT, 
       z.FSTRSPECIALFILETYPE, 
       z.FBLNSPECIALTAXRESIDENCY, 
       z.FSTRNONRESIDENTTYPE, 
       z.FSTRCURRENTTAXRESIDENCY, 
       z.FSTRCLOSUREREASON, 
       z.FINTSMSCOUNTRYCODE, 
       z.FSTRSMSAREACODE, 
       z.FSTRSMSPHONENUMBER, 
       z.FDTMINCOMEBALANCEDATE, 
       z.FSTRCUSTOMERCLASS, 
       z.FSTRWHO, 
       z.FDTMWHEN, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.app_tblnz_customerstd z 
LEFT OUTER JOIN dev_raw.app_tblcustomerlevel cl ON z.FLNGDOCKEY = cl.FLNGDOCKEY 
WHERE nvl(cl.fstrcustomerlevel, 'STD') = 'STD' 
AND nvl(cl.record_active_flag, 'Y') = 'Y' 
AND nvl(cl.record_deleted_flag, 'N') = 'N' ;
  
  
  
CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.ref_lanindicator
AS 
SELECT z.FSTRLANGUAGE, 
       z.FSTRINDICATOR, 
       z.FSTRDECODE1, 
       z.FSTRDECODE2, 
       z.fstrDescription, 
       z.record_effective_timestamp, 
       z.record_expiry_timestamp, 
       z.record_active_flag, 
       z.record_deleted_flag, 
       z.insert_object_run_key, 
       z.update_object_run_key 
FROM ${target_db=Enter the target database name here}_raw.ref_lanindicator z ;

CREATE VIEW ${target_db=Enter the target database name here}_raw_restricted_access.app_tblcustomerhistory
AS SELECT z.flngCustomerKey, 
       z.flngVerLast, 
       z.fstrCustomerTypeFrom, 
       z.fstrCustomerTypeTo, 
       z.flngDocKeyFrom, 
       z.flngDocKeyTo, 
       z.fstrWho, 
       z.fdtmWhen, 
       Z.record_effective_timestamp, 
       Z.record_expiry_timestamp, 
       Z.record_active_flag, 
       Z.record_deleted_flag, 
       Z.insert_object_run_key, 
       Z.update_object_run_keY 
FROM dev_dw.app_tblcustomerhistory z ;


